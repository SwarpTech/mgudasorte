function doGet(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var data = sheet.getDataRange().getValues();
  var jsonData = [];
  
  // Pula o cabeçalho (linha 1) e processa os dados
  for (var i = 1; i < data.length; i++) {
    if (data[i][0] && data[i][1]) { // Verifica se nome e recorde existem
      jsonData.push({
        nome: data[i][0],
        rebate: data[i][1]
      });
    }
  }
  
  // Ordena por recorde (maior primeiro)
  jsonData.sort(function(a, b) {
    return b.rebate - a.rebate;
  });
  
  return ContentService.createTextOutput(JSON.stringify(jsonData))
    .setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var data;
  
  try {
    data = JSON.parse(e.postData.contents);
  } catch (error) {
    // Se falhar ao parsear JSON, tenta ler como FormData
    data = {
      nome: e.parameter.nome,
      rebate: e.parameter.rebate
    };
  }

  if (data.nome && data.rebate) {
    sheet.appendRow([data.nome, data.rebate]);
    
    return ContentService.createTextOutput(JSON.stringify({
      status: "success",
      message: "Recorde salvo com sucesso"
    })).setMimeType(ContentService.MimeType.JSON);
  } else {
    return ContentService.createTextOutput(JSON.stringify({
      status: "error",
      message: "Dados incompletos. Nome e rebate são obrigatórios."
    })).setMimeType(ContentService.MimeType.JSON);
  }
}
