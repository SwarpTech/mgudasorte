<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MGU DA SORTE - Pong Game</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background-color: #25262C;
      color: #fdd760;
      font-family: 'Montserrat', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 110vh;
      text-align: center;
      overflow: auto;
      padding-top: 20px;
    }
    .game-container {
      position: relative;
      width: 800px;
      height: 500px;
      margin-bottom: 20px;
    }
    #gameCanvas, #confeteCanvas {
      position: absolute;
      top: 0;
      left: 0;
    }
    #gameCanvas {
      border: 4px solid #fdd760;
      background-color: #25262C;
      z-index: 1;
    }
    #confeteCanvas {
      pointer-events: none;
      z-index: 2;
    }
    h1 { margin-bottom: 10px; }
    p { margin-bottom: 22px; font-size: 18px; }
    #contadorRebates, #contadorRebatesFase2, #recordRebates {
      font-size: 18px;
      margin-bottom: 15px;
      background-color: #fdd760;
      color: #25262C;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: bold;
      display: inline-block;
    }
    #contadorRebatesFase2, #recordRebates {
      display: none;
      background-color: #ff6b6b;
    }
    button, #copyCupomBtn {
      padding: 10px 20px;
      background-color: #fdd760;
      color: #25262C;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: none;
      margin-top: 10px;
      width: 80%;
      max-width: 300px;
    }
    .logo { width: 150px; margin-bottom: 15px; }
    #mensagemFinal, #mensagemDerrota { font-size: 20px; margin-top: 20px; }
    #mensagemDerrota { color: red; }
    #cupomFinal {
      display: none;
      font-size: 24px;
      font-weight: bold;
      margin-top: 10px;
      background-color: #fdd760;
      color: #25262C;
      padding: 10px 20px;
      border-radius: 10px;
    }
    .botao-central {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 999;
      background-color: #fdd760;
      color: #25262C;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 18px;
      cursor: pointer;
    }
    #botaoStart { display: block; }
    #botaoAvancar, #botaoNovoJogo, #botaoReiniciar { display: none; }
    #ranking {
      position: fixed;
      left: 20px;
      top: 20px;
      background: rgba(0,0,0,0.6);
      padding: 15px;
      border-radius: 8px;
      max-height: 400px;
      overflow-y: auto;
      color: #fdd760;
      font-size: 14px;
      font-family: 'Montserrat', sans-serif;
      z-index: 9999;
    }
    #ranking h2 {
      color: #00ffcc;
      font-size: 20px;
      margin-bottom: 10px;
    }
    #rankingList {
      color: #ffffff;
      font-size: 16px;
      line-height: 1.8;
      font-family: monospace;
      background: #000;
      padding: 10px;
      border-radius: 8px;
    }
    #rankingList div {
      padding: 3px;
      border-bottom: 1px solid #333;
    }
    .confete {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: #f00;
      border-radius: 50%;
    }
    .mensagem-centralizada {
      position: fixed;
      top: calc(50% + 100px);
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      text-align: center;
      width: 80%;
      max-width: 500px;
    }
    .mensagem-top3 {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1001;
      background-color: #fdd760;
      color: #25262C;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      width: 80%;
      max-width: 400px;
    }
  </style>
</head>
<body>
  <!-- ELEMENTOS DO JOGO -->
  <input id="playerNameInput" type="text" placeholder="Digite seu nome (obrigat√≥rio)" style="position: fixed; top: calc(50% + 70px); left: 50%; transform: translateX(-50%); z-index: 999; padding: 10px; font-size: 16px; border-radius: 8px; border: none; width: 80%; max-width: 300px;" />
  <button id="botaoStart" class="botao-central">START</button>
  <button id="botaoAvancar" class="botao-central">Avan√ßar de Fase</button>
  <button id="botaoNovoJogo" class="botao-central">Novo Jogo</button>
  <button id="botaoReiniciar" class="botao-central">Tentar Novamente</button>

  <!-- Mensagens centralizadas -->
  <div id="mensagemFinal" class="mensagem-centralizada" style="display:none;">
    <p>Parab√©ns! Voc√™ completou a fase!</p>
    <div id="cupomFinal" style="margin-top: 15px;">Cupom: <strong id="cupomCode">SORTEMGU</strong> <span style="cursor:pointer;">üìã</span></div>
  </div>

  <p id="mensagemDerrota" style="display:none;"></p>

  <img src="logo-mgu1.png" alt="Logo MGU" class="logo">
  <h1>MGU DA SORTE</h1>
  <p>Voc√™ j√° est√° concorrendo ao PS5! Complete a fase para ganhar um presente misterioso.</p>
  <p><strong>Miss√£o:</strong> Rebata a bolinha 10 vezes!</p>
  <p id="contadorRebates">Rebates: 0 / 10</p>
  <p id="contadorRebatesFase2">Rebates: <span id="rebatesAtuais">0</span></p>
  <p id="recordRebates">Recorde: <span id="melhorRebate">0</span></p>

  <div class="game-container" style="margin-bottom: 100px;">
    <canvas id="gameCanvas" width="800" height="500"></canvas>
    <canvas id="confeteCanvas" width="800" height="500"></canvas>
  </div>

  <div id="ranking">
    <h2>üèÜ Ranking dos Jogadores</h2>
    <div id="rankingList">Carregando ranking...</div>
  </div>

  <!-- SCRIPTS DO JOGO -->
  <script>
    // Configura√ß√µes do jogo
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw5t4hzA-66vvYPHDzklvbrNO7nOYAbGx9uYrguoVjKll6wclU3DBo3TEZxSm5lpeJp/exec";
    let fimDeJogoAtivo = false;
    let gameInterval = null;
    let confeteInterval = null;

    window.onload = function () {
      // Elementos do DOM
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      const confeteCanvas = document.getElementById("confeteCanvas");
      const confeteCtx = confeteCanvas.getContext("2d");
      const mensagemFinal = document.getElementById("mensagemFinal");
      const mensagemDerrota = document.getElementById("mensagemDerrota");
      const botaoReiniciar = document.getElementById("botaoReiniciar");
      const contadorRebates = document.getElementById("contadorRebates");
      const contadorRebatesFase2 = document.getElementById("contadorRebatesFase2");
      const rebatesAtuais = document.getElementById("rebatesAtuais");
      const recordRebates = document.getElementById("recordRebates");
      const melhorRebate = document.getElementById("melhorRebate");
      const cupomFinal = document.getElementById("cupomFinal");
      const cupomCode = document.getElementById("cupomCode");
      const botaoStart = document.getElementById("botaoStart");
      const botaoAvancar = document.getElementById("botaoAvancar");
      const botaoNovoJogo = document.getElementById("botaoNovoJogo");
      const playerNameInput = document.getElementById("playerNameInput");
      const rankingList = document.getElementById("rankingList");

      // Vari√°veis do jogo
      const paddleHeight = 100, paddleWidth = 40, ballRadius = 20, goalRebounds = 10;
      const ballSpeedBase = 5, aumentoVelocidade = 0.05;
      let playerName = "";
      let playerY, aiY, ballX, ballY, ballSpeedX, ballSpeedY;
      let rebounds = 0, mouseMoveHandler, touchMoveHandler;
      let confetes = [], emFase2 = false, velocidadeExtra = 0;
      let recordRebatesValue = parseInt(localStorage.getItem('recordRebatesMGU')) || 0;
      let rebatesFase2 = 0;
      let recordHolderName = localStorage.getItem('recordHolderNameMGU') || "-";
      let top3Ranking = [];

      // Inicializa√ß√£o
      melhorRebate.textContent = recordRebatesValue + " (" + recordHolderName + ")";
      carregarRanking();

      // Event Listeners
      botaoStart.addEventListener('click', startGame);
      botaoAvancar.addEventListener('click', iniciarFase2);
      botaoNovoJogo.addEventListener('click', reiniciarFase2);
      botaoReiniciar.addEventListener('click', reiniciarJogo);
      document.querySelector('#cupomFinal span').addEventListener('click', copiarCupom);

      // Fun√ß√µes do jogo
      function initGame() {
        playerY = canvas.height / 2 - paddleHeight / 2;
        aiY = canvas.height / 2 - paddleHeight / 2;
        ballX = canvas.width / 2;
        ballY = canvas.height / 2;
        velocidadeExtra = 0;
        ballSpeedX = ballSpeedBase * (Math.random() > 0.5 ? 1 : -1);
        ballSpeedY = 3 * (Math.random() > 0.5 ? 1 : -1);
        rebounds = 0;
        rebatesFase2 = 0;
        rebatesAtuais.textContent = "0";
        contadorRebates.textContent = `Rebates: ${rebounds} / ${goalRebounds}`;
        contadorRebatesFase2.style.display = emFase2 ? "inline-block" : "none";
        recordRebates.style.display = emFase2 ? "inline-block" : "none";
        contadorRebates.style.display = emFase2 ? "none" : "inline-block";
        mensagemFinal.style.display = "none";
        mensagemDerrota.style.display = "none";
        botaoReiniciar.style.display = "none";
        botaoAvancar.style.display = "none";
        botaoNovoJogo.style.display = "none";
        confetes = [];
        confeteCtx.clearRect(0, 0, confeteCanvas.width, confeteCanvas.height);

        if (gameInterval) {
          cancelAnimationFrame(gameInterval);
          gameInterval = null;
        }
        if (confeteInterval) {
          clearInterval(confeteInterval);
          confeteInterval = null;
        }

        mouseMoveHandler = e => {
          const rect = canvas.getBoundingClientRect();
          playerY = e.clientY - rect.top - paddleHeight / 2;
          playerY = Math.max(0, Math.min(canvas.height - paddleHeight, playerY));
        };
        touchMoveHandler = e => {
          const touch = e.touches[0];
          const rect = canvas.getBoundingClientRect();
          playerY = touch.clientY - rect.top - paddleHeight / 2;
          playerY = Math.max(0, Math.min(canvas.height - paddleHeight, playerY));
        };

        if (!fimDeJogoAtivo) {
          document.addEventListener('mousemove', mouseMoveHandler);
          canvas.addEventListener('touchmove', touchMoveHandler);
        }

        draw();
      }

      function drawRect(x, y, w, h, color) {
        ctx.fillStyle = color;
        ctx.fillRect(x, y, w, h);
      }

      function drawVerticalText(text, x, y, color = "#25262C") {
        ctx.save();
        ctx.translate(x + 12, y);
        ctx.rotate(Math.PI / 2);
        ctx.font = "bold 16px Montserrat";
        ctx.fillStyle = color;
        ctx.fillText(text, 0, 0);
        ctx.restore();
      }

      function drawBall(x, y, radius, color) {
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.closePath();
      }

      function draw() {
        drawRect(0, 0, canvas.width, canvas.height, "#25262C");
        drawRect(0, playerY, paddleWidth, paddleHeight, "#fdd760");
        drawVerticalText("VOC√ä", 0, playerY + 10);
        drawRect(canvas.width - paddleWidth, aiY, paddleWidth, paddleHeight, "#fdd760");
        drawBall(ballX, ballY, ballRadius, "#fdd760");
      }

      function update() {
        ballX += ballSpeedX;
        ballY += ballSpeedY;
        let aiCenter = aiY + paddleHeight / 2;
        if (aiCenter < ballY - 35) aiY += 6;
        else if (aiCenter > ballY + 35) aiY -= 6;
        aiY = Math.max(0, Math.min(canvas.height - paddleHeight, aiY));
        if (ballY + ballRadius > canvas.height || ballY - ballRadius < 0) {
          ballSpeedY *= -1;
          ballY = Math.max(ballRadius + 1, Math.min(canvas.height - ballRadius - 1, ballY));
        }
        if (ballX - ballRadius <= paddleWidth + 2 && ballY + ballRadius >= playerY && ballY - ballRadius <= playerY + paddleHeight) {
          const angle = ((ballY - (playerY + paddleHeight / 2)) / (paddleHeight / 2)) * Math.PI / 4;
          const speed = ballSpeedBase + rebounds * 0.4;
          ballSpeedX = speed * Math.cos(angle);
          ballSpeedY = speed * Math.sin(angle);
          rebounds++;
          contadorRebates.textContent = `Rebates: ${rebounds} / ${goalRebounds}`;
        } else if (ballX - ballRadius < 0) {
          fimDeJogo(false);
          return;
        }
        if (ballX + ballRadius > canvas.width - paddleWidth && ballY + ballRadius >= aiY && ballY - ballRadius <= aiY + paddleHeight) {
          ballSpeedX *= -1;
        } else if (ballX + ballRadius > canvas.width) {
          fimDeJogo(true);
        }
        if (rebounds >= goalRebounds && !emFase2) {
          fimDeJogo(true);
        }
        draw();
      }

      function fase2Game() {
        if (!emFase2) return;
        velocidadeExtra += aumentoVelocidade;
        ballX += ballSpeedX;
        ballY += ballSpeedY;
        aiY = ballY - paddleHeight / 2;
        aiY = Math.max(0, Math.min(canvas.height - paddleHeight, aiY));
        if (ballY + ballRadius > canvas.height || ballY - ballRadius < 0) {
          ballSpeedY *= -1;
          ballY = Math.max(ballRadius + 1, Math.min(canvas.height - ballRadius - 1, ballY));
        }
        if (ballX - ballRadius <= paddleWidth + 2 && ballY + ballRadius >= playerY && ballY - ballRadius <= playerY + paddleHeight) {
          const angle = ((ballY - (playerY + paddleHeight / 2)) / (paddleHeight / 2)) * Math.PI / 4;
          const speed = ballSpeedBase + velocidadeExtra;
          ballSpeedX = speed * Math.cos(angle);
          ballSpeedY = speed * Math.sin(angle);
          rebatesFase2++;
          if (rebatesFase2 > 9999) rebatesFase2 = 9999;
          rebatesAtuais.textContent = rebatesFase2;
          if (rebatesFase2 > recordRebatesValue) {
            recordRebatesValue = rebatesFase2;
            recordHolderName = playerName;
            melhorRebate.textContent = recordRebatesValue + " (" + recordHolderName + ")";
            localStorage.setItem('recordRebatesMGU', recordRebatesValue);
            localStorage.setItem('recordHolderNameMGU', recordHolderName);
          }
        } else if (ballX - ballRadius < 0) {
          fimDeJogo(false);
          return;
        }
        if (ballX + ballRadius > canvas.width - paddleWidth && ballY + ballRadius >= aiY && ballY - ballRadius <= aiY + paddleHeight) {
          ballSpeedX *= -1;
        } else if (ballX + ballRadius > canvas.width) {
          fimDeJogo(true);
        }
        draw();
      }

      function startGame() {
        playerName = playerNameInput.value.trim();
        if (!playerName) {
          alert("Por favor, digite seu nome antes de come√ßar.");
          return;
        }
        
        if (gameInterval) {
          cancelAnimationFrame(gameInterval);
          gameInterval = null;
        }
        
        fimDeJogoAtivo = false;
        playerNameInput.style.display = "none";
        botaoStart.style.display = "none";
        canvas.style.cursor = 'none';
        emFase2 = false;
        initGame();
        
        function gameLoopFase1() {
          if (fimDeJogoAtivo) return;
          update();
          draw();
          gameInterval = requestAnimationFrame(gameLoopFase1);
        }
        gameLoopFase1();
      }

      function iniciarFase2() {
        if (gameInterval) {
          cancelAnimationFrame(gameInterval);
          gameInterval = null;
        }
        
        fimDeJogoAtivo = false;
        botaoAvancar.style.display = 'none';
        botaoNovoJogo.style.display = 'none';
        botaoReiniciar.style.display = 'none';
        canvas.style.cursor = 'none';
        emFase2 = true;
        velocidadeExtra = 0;
        mensagemFinal.style.display = 'none';
        mensagemDerrota.style.display = 'none';
        contadorRebatesFase2.style.display = "inline-block";
        recordRebates.style.display = "inline-block";
        contadorRebates.style.display = "none";
        rebatesFase2 = 0;
        rebatesAtuais.textContent = "0";
        initGame();
        
        function gameLoopFase2() {
          if (!emFase2) return;
          fase2Game();
          gameInterval = requestAnimationFrame(gameLoopFase2);
        }
        gameLoopFase2();
      }

      function reiniciarFase2() {
        if (gameInterval) {
          cancelAnimationFrame(gameInterval);
          gameInterval = null;
        }
        
        fimDeJogoAtivo = false;
        botaoNovoJogo.style.display = 'none';
        botaoReiniciar.style.display = 'none';
        canvas.style.cursor = 'none';
        emFase2 = true;
        velocidadeExtra = 0;
        initGame();
        
        function gameLoopFase2() {
          fase2Game();
          gameInterval = requestAnimationFrame(gameLoopFase2);
        }
        gameLoopFase2();
      }

      function reiniciarJogo() {
        if (gameInterval) {
          cancelAnimationFrame(gameInterval);
          gameInterval = null;
        }
        
        fimDeJogoAtivo = false;
        botaoStart.style.display = "none";
        botaoReiniciar.style.display = "none";
        botaoNovoJogo.style.display = "none";
        canvas.style.cursor = 'none';
        emFase2 = false;
        initGame();
        
        function gameLoopFase1() {
          if (fimDeJogoAtivo) return;
          update();
          draw();
          gameInterval = requestAnimationFrame(gameLoopFase1);
        }
        gameLoopFase1();
      }

      function fimDeJogo(venceu) {
        fimDeJogoAtivo = true;
        
        if (gameInterval) {
          cancelAnimationFrame(gameInterval);
          gameInterval = null;
        }
        
        document.removeEventListener('mousemove', mouseMoveHandler);
        canvas.removeEventListener('touchmove', touchMoveHandler);
        canvas.style.cursor = 'auto';
        draw();
        
        const estavaNaFase2 = emFase2;
        emFase2 = false;
        
        if (estavaNaFase2) {
          if (venceu) {
            mensagemFinal.textContent = `INCR√çVEL! Voc√™ venceu com ${rebatesFase2} rebatidas! üèÜ`;
            mensagemFinal.style.display = 'block';
            startConfete();
            botaoNovoJogo.style.display = 'block';
            
            // Verifica se entrou no top 3 ap√≥s o jogo terminar
            const isTop3 = top3Ranking.length < 3 || rebatesFase2 > top3Ranking[top3Ranking.length - 1].rebate;
            if (isTop3) {
              setTimeout(() => mostrarMensagemTop3(playerName, rebatesFase2), 1000);
            }
            
            // Envia o recorde ap√≥s o jogo terminar
            enviarRecorde(playerName, rebatesFase2);
          } else {
            mensagemDerrota.textContent = `Voc√™ fez ${rebatesFase2} rebatidas! Seu recorde: ${recordRebatesValue}`;
            mensagemDerrota.style.display = 'block';
            botaoNovoJogo.style.display = 'block';
          }
        } else {
          if (venceu) {
            mensagemFinal.style.display = "block";
            cupomFinal.style.display = "block";
            botaoAvancar.style.display = 'block';
            startConfete();
          } else {
            mensagemDerrota.textContent = "Voc√™ perdeu! Tente novamente para garantir seu cupom.";
            mensagemDerrota.style.display = "block";
            botaoReiniciar.style.display = "block";
          }
        }
      }

      // Fun√ß√µes de confete
      function startConfete() {
        if (confeteInterval) {
          clearInterval(confeteInterval);
        }
        
        confeteInterval = setInterval(() => {
          criarConfete();
        }, 100);
        
        setTimeout(() => {
          clearInterval(confeteInterval);
          confeteInterval = null;
        }, 3000);
      }

      function criarConfete() {
        const colors = ['#f00', '#0f0', '#00f', '#ff0', '#f0f', '#0ff'];
        const confete = {
          x: Math.random() * confeteCanvas.width,
          y: -10,
          color: colors[Math.floor(Math.random() * colors.length)],
          size: Math.random() * 10 + 5,
          speed: Math.random() * 3 + 2,
          angle: Math.random() * Math.PI * 2,
          rotationSpeed: Math.random() * 0.2 - 0.1
        };
        confetes.push(confete);
        
        if (confetes.length > 200) {
          confetes.shift();
        }
        
        animarConfetes();
      }

      function animarConfetes() {
        confeteCtx.clearRect(0, 0, confeteCanvas.width, confeteCanvas.height);
        
        for (let i = 0; i < confetes.length; i++) {
          const confete = confetes[i];
          confete.y += confete.speed;
          confete.angle += confete.rotationSpeed;
          
          confeteCtx.save();
          confeteCtx.translate(confete.x, confete.y);
          confeteCtx.rotate(confete.angle);
          confeteCtx.fillStyle = confete.color;
          confeteCtx.fillRect(-confete.size/2, -confete.size/2, confete.size, confete.size);
          confeteCtx.restore();
          
          if (confete.y > confeteCanvas.height) {
            confetes.splice(i, 1);
            i--;
          }
        }
        
        if (confetes.length > 0) {
          requestAnimationFrame(animarConfetes);
        }
      }

      // Fun√ß√µes de integra√ß√£o com Google Sheets
      function carregarRanking() {
        fetch(`${GOOGLE_SCRIPT_URL}?action=getRanking`)
          .then(response => {
            if (!response.ok) throw new Error('Erro na rede');
            return response.json();
          })
          .then(data => {
            console.log("Dados recebidos:", data);
            if (data && data.length > 0) {
              top3Ranking = data.slice(0, 3); // Guarda os 3 primeiros para verifica√ß√£o
              atualizarRankingUI(data);
              // Atualiza o recorde exibido com o 1¬∫ lugar da planilha
              if (data[0] && data[0].rebate) {
                recordRebatesValue = data[0].rebate;
                recordHolderName = data[0].nome;
                melhorRebate.textContent = recordRebatesValue + " (" + recordHolderName + ")";
              }
            } else {
              mostrarDadosExemplo();
            }
          })
          .catch(err => {
            console.error("Erro ao carregar ranking:", err);
            mostrarDadosExemplo();
          });
      }

      function enviarRecorde(nome, rebate) {
        // Cria URL com par√¢metros
        const url = `${GOOGLE_SCRIPT_URL}?action=saveRecord&nome=${encodeURIComponent(nome)}&rebate=${rebate}`;
        
        // Primeiro tenta como GET
        fetch(url, {
          method: "GET",
          redirect: "follow"
        })
        .then(response => {
          if (!response.ok) throw new Error('Erro na rede');
          return response.json();
        })
        .then(data => {
          console.log("Recorde enviado com sucesso:", data);
          carregarRanking(); // Atualiza o ranking ap√≥s enviar
        })
        .catch(err => {
          console.error("Erro ao enviar recorde (GET):", err);
          // Se GET falhar, tenta como POST
          enviarComoPost(nome, rebate);
        });
      }

      function enviarComoPost(nome, rebate) {
        const formData = new FormData();
        formData.append('action', 'saveRecord');
        formData.append('nome', nome);
        formData.append('rebate', rebate);

        fetch(GOOGLE_SCRIPT_URL, {
          method: "POST",
          body: formData,
          redirect: "follow"
        })
        .then(response => response.json())
        .then(data => {
          console.log("Recorde enviado via POST:", data);
          carregarRanking();
        })
        .catch(err => {
          console.error("Erro ao enviar via POST:", err);
        });
      }

      function atualizarRankingUI(data) {
        const sorted = data
          .filter(row => row.nome && !isNaN(row.rebate))
          .sort((a, b) => b.rebate - a.rebate)
          .slice(0, 10);
        
        rankingList.innerHTML = sorted.map((row, index) => {
          const emoji = index === 0 ? "ü•á" : index === 1 ? "ü•à" : index === 2 ? "ü•â" : "üîπ";
          const isCurrentPlayer = row.nome === playerName && row.rebate === rebatesFase2;
          const highlight = isCurrentPlayer ? "style='background-color: #333;'" : "";
          return `<div ${highlight}>
            ${emoji} ${index + 1}¬∫ ${row.nome}: ${row.rebate} rebatidas
          </div>`;
        }).join("");
      }

      function mostrarMensagemTop3(nome, rebates) {
        const mensagem = document.createElement('div');
        mensagem.className = 'mensagem-top3';
        mensagem.innerHTML = `
          <h2 style="margin-bottom: 10px;">üéâ PARAB√âNS ${nome.toUpperCase()}! üéâ</h2>
          <p style="font-size: 18px; margin-bottom: 15px;">Voc√™ entrou para o TOP 3 do ranking!</p>
          <p style="font-size: 24px; font-weight: bold;">${rebates} REBATIDAS</p>
          <button id="fecharMensagem" style="margin-top: 15px; padding: 8px 16px; background-color: #25262C; color: #fdd760; border: none; border-radius: 5px; cursor: pointer;">Fechar</button>
        `;
        
        document.body.appendChild(mensagem);
        
        document.getElementById('fecharMensagem').addEventListener('click', function() {
          document.body.removeChild(mensagem);
        });
      }

      function mostrarDadosExemplo() {
        const fakeData = [
          { nome: "Sandro", rebate: 34 },
          { nome: "Jo√£o", rebate: 28 },
          { nome: "Maria", rebate: 23 },
          { nome: "Luiz", rebate: 20 },
          { nome: "Ana", rebate: 18 }
        ];
        
        rankingList.innerHTML = `
          <div style='color: #ff6b6b; padding: 5px;'>
            Ranking offline (dados de exemplo)
          </div>
          ${fakeData.map((row, index) => {
            const emoji = index === 0 ? "ü•á" : index === 1 ? "ü•à" : index === 2 ? "ü•â" : "üîπ";
            return `<div>${emoji} ${index + 1}¬∫ ${row.nome}: ${row.rebate}</div>`;
          }).join("")}
          <div style='color: #aaa; padding: 5px; font-size: 14px;'>
            Conecte-se √† internet para ver o ranking real
          </div>
        `;
      }

      function copiarCupom() {
        const textarea = document.createElement('textarea');
        textarea.value = document.getElementById('cupomCode').textContent;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('Cupom copiado para a √°rea de transfer√™ncia!');
      }

      // Inicializa√ß√£o
      setTimeout(() => {
        document.getElementById("ranking").style.display = "block";
        document.getElementById("botaoStart").style.display = "block";
      }, 200);
    };
  </script>
</body>
</html>
